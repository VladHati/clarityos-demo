<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClarityOS — Grab Indonesia</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Instrument+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ═══════════════════════════════════════════
   RESET & VARIABLES
   ═══════════════════════════════════════════ */
*{margin:0;padding:0;box-sizing:border-box;}
:root{
  --bg:#0A0A0F;--s1:#111118;--s2:#1A1A25;--s3:#22222F;
  --wire:rgba(255,255,255,0.06);--wire2:rgba(255,255,255,0.08);
  --violet:#7B2FBE;--violet-g:#9B4FDE;--violet-dim:rgba(123,47,190,0.15);
  --aurora:#0EF3C5;--aurora-dim:rgba(14,243,197,0.1);
  --thermal:#FF2D78;--thermal-dim:rgba(255,45,120,0.1);
  --amber:#fbbf24;--amber-dim:rgba(251,191,36,0.1);
  --blue:#60a5fa;--blue-dim:rgba(96,165,250,0.1);
  --text-1:#F0EDE8;--text-2:#C8C4BE;--text-3:#8B8B9B;--text-4:#5A5A6E;--text-5:#3A3A4D;
  --glass-bg:rgba(255,255,255,0.03);--glass-border:rgba(255,255,255,0.06);
  --glass-hover:rgba(255,255,255,0.05);--glass-hover-border:rgba(255,255,255,0.1);
  --rail-w:56px;--header-h:52px;
  --font-display:'DM Sans',sans-serif;
  --font-body:'Instrument Sans',sans-serif;
  --font-mono:'DM Mono',monospace;
}
html,body{height:100%;overflow:hidden;}
body{
  background:var(--bg);color:var(--text-1);font-family:var(--font-body);
  font-size:15px;line-height:1.6;letter-spacing:-0.01em;
  -webkit-font-smoothing:antialiased;
  display:flex;flex-direction:column;
}
::selection{background:var(--violet);color:white;}
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.08);border-radius:3px;}
::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,0.14);}

/* ═══════════════════════════════════════════
   BACKGROUND GLOWS
   ═══════════════════════════════════════════ */
body::before,body::after{
  content:'';position:fixed;border-radius:50%;pointer-events:none;z-index:0;
  filter:blur(120px);opacity:0.07;
}
body::before{width:600px;height:600px;background:var(--violet);top:-200px;left:-200px;}
body::after{width:500px;height:500px;background:var(--aurora);bottom:-200px;right:-100px;}

/* ═══════════════════════════════════════════
   HEADER
   ═══════════════════════════════════════════ */
.header{
  height:48px;background:rgba(17,17,24,0.6);
  backdrop-filter:blur(24px) saturate(180%);
  border-bottom:1px solid rgba(255,255,255,0.05);
  display:flex;align-items:center;padding:0 32px 0 0;
  position:relative;z-index:100;flex-shrink:0;
}
.header-brand{
  width:var(--rail-w);height:100%;display:flex;align-items:center;justify-content:center;
  flex-shrink:0;
}
.header-brand .hci{
  width:20px;height:20px;border-radius:6px;background:#00b14f;
}
.header-title{
  font-family:var(--font-display);font-size:14px;font-weight:500;letter-spacing:-0.03em;
  margin-left:8px;
}
.header-client{
  font-family:var(--font-mono);font-size:9px;color:var(--text-3);
  text-transform:uppercase;letter-spacing:0.08em;
  margin-left:12px;padding:4px 10px;border-radius:6px;
  background:var(--glass-bg);border:1px solid var(--wire);
}
.header-right{margin-left:auto;display:flex;align-items:center;gap:16px;}
.header-datetime{font-family:var(--font-mono);font-size:10px;color:var(--text-3);}
.header-live{
  display:flex;align-items:center;gap:6px;
  font-family:var(--font-mono);font-size:10px;color:var(--aurora);
}
.header-live-dot{width:5px;height:5px;border-radius:50%;background:var(--aurora);box-shadow:0 0 8px rgba(14,243,197,0.4);animation:liveBreathe 2s ease-in-out infinite;}
@keyframes liveBreathe{0%,100%{opacity:1;box-shadow:0 0 8px rgba(14,243,197,0.4)}50%{opacity:0.5;box-shadow:0 0 4px rgba(14,243,197,0.2)}}
.header-alerts{
  display:flex;align-items:center;gap:6px;
  font-family:var(--font-mono);font-size:10px;color:var(--thermal);
  padding:4px 12px;border-radius:999px;
  background:var(--thermal-dim);border:1px solid rgba(255,45,120,0.2);
  animation:alertPulse 2.5s ease-in-out infinite;
}
.alert-dot{width:6px;height:6px;border-radius:50%;background:var(--thermal);animation:pd 2s infinite;}
@keyframes pd{0%,100%{opacity:1}50%{opacity:0.3}}
@keyframes alertPulse{
  0%,100%{box-shadow:0 0 4px rgba(255,45,120,0.15);border-color:rgba(255,45,120,0.2)}
  50%{box-shadow:0 0 14px rgba(255,45,120,0.35),0 0 24px rgba(255,45,120,0.1);border-color:rgba(255,45,120,0.35)}
}

/* ═══════════════════════════════════════════
   LAYOUT SHELL
   ═══════════════════════════════════════════ */
.shell{display:flex;flex:1;overflow:hidden;position:relative;z-index:1;}

/* ═══════════════════════════════════════════
   ICON RAIL
   ═══════════════════════════════════════════ */
.rail{
  width:var(--rail-w);background:var(--bg);
  border-right:1px solid rgba(255,255,255,0.05);
  display:flex;flex-direction:column;align-items:center;
  padding:16px 0;flex-shrink:0;gap:2px;
  position:relative;z-index:50;
}
.rail-logo{
  width:32px;height:32px;border-radius:10px;
  background:linear-gradient(135deg,var(--violet),var(--violet-g));
  display:flex;align-items:center;justify-content:center;
  margin-bottom:24px;box-shadow:0 0 20px rgba(123,47,190,0.25);flex-shrink:0;
}
.rail-logo span{font-family:var(--font-display);color:white;font-size:13px;font-weight:500;}
.rail-sep{width:24px;height:1px;background:rgba(255,255,255,0.05);margin:8px 0;flex-shrink:0;}
.rail-item{
  width:38px;height:38px;border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;position:relative;
  transition:all 120ms ease;color:var(--text-3);
}
.rail-item:hover{background:rgba(255,255,255,0.04);color:var(--text-2);}
.rail-item.active{background:rgba(255,255,255,0.06);color:var(--aurora);}
.rail-item.active::before{
  content:'';position:absolute;left:-1px;top:8px;bottom:8px;width:2px;
  border-radius:0 2px 2px 0;background:var(--aurora);
}
.rail-item svg{width:16px;height:16px;stroke-width:1.5;}
.rail-tooltip{
  position:absolute;left:52px;top:50%;transform:translateY(-50%);
  padding:4px 10px;border-radius:8px;font-size:12px;font-weight:500;
  background:var(--s2);border:1px solid var(--wire2);color:var(--text-1);
  white-space:nowrap;pointer-events:none;opacity:0;transition:opacity 0.15s;z-index:99;
  font-family:var(--font-body);
}
.rail-item:hover .rail-tooltip{opacity:1;}
.rail-bottom{margin-top:auto;display:flex;flex-direction:column;align-items:center;gap:4px;}
.rail-avatar{
  width:30px;height:30px;border-radius:50%;
  background:linear-gradient(135deg,#00B14F,#008f3f);
  border:1px solid rgba(255,255,255,0.05);
  display:flex;align-items:center;justify-content:center;margin-top:4px;
}
.rail-avatar span{font-size:9px;font-weight:600;font-family:var(--font-mono);color:white;}

/* ═══════════════════════════════════════════
   MAIN CONTENT
   ═══════════════════════════════════════════ */
.main{flex:1;overflow-y:auto;overflow-x:hidden;padding:24px 32px 100px;position:relative;}

/* ═══════════════════════════════════════════
   VIEW TRANSITIONS
   ═══════════════════════════════════════════ */
.view{
  display:none;opacity:0;transform:translateY(8px);
  transition:opacity 150ms ease, transform 150ms ease;
}
.view.active{display:block;}
.view.visible{opacity:1;transform:translateY(0);transition:opacity 250ms ease-out, transform 250ms ease-out;}

/* ═══════════════════════════════════════════
   GLASS CARD
   ═══════════════════════════════════════════ */
.card{
  padding:20px;border-radius:16px;
  background:rgba(255,255,255,0.03);
  backdrop-filter:blur(12px) saturate(150%);
  border:1px solid var(--wire2);
  transition:all 0.25s ease;
}
.card:hover{background:rgba(255,255,255,0.05);border-color:var(--glass-hover-border);}
.card-clickable{cursor:pointer;}
.card-clickable:hover{transform:translateY(-1px);box-shadow:0 8px 32px rgba(0,0,0,0.3);}

/* ═══════════════════════════════════════════
   SOURCE BAR (Monitor top)
   ═══════════════════════════════════════════ */
.source-bar{
  display:flex;align-items:center;gap:8px;margin-bottom:20px;
  padding:8px 20px;border-bottom:1px solid rgba(255,255,255,0.05);
  overflow-x:auto;border-radius:0;background:transparent;
}
.source-bar::-webkit-scrollbar{display:none;}
.source-bar-label{
  font-family:var(--font-mono);font-size:9px;color:var(--text-4);
  text-transform:uppercase;letter-spacing:0.06em;margin-right:4px;
}
.source-pill{
  display:flex;align-items:center;gap:5px;
  padding:3px 10px;border-radius:8px;font-family:var(--font-mono);font-size:9px;
  background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);color:var(--text-2);
  cursor:pointer;transition:all 150ms;letter-spacing:0.03em;text-transform:uppercase;
}
.source-pill:hover{background:rgba(255,255,255,0.06);border-color:rgba(255,255,255,0.14);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.2);}
.source-pill.active{background:rgba(14,243,197,0.05);border-color:rgba(14,243,197,0.2);}
.source-dot{width:5px;height:5px;border-radius:50%;}
.source-dot.streaming{background:var(--aurora);box-shadow:0 0 8px rgba(14,243,197,0.4);}
.source-dot.daily{background:var(--blue);}

/* ═══════════════════════════════════════════
   NPS HERO CARD
   ═══════════════════════════════════════════ */
.hero{
  position:relative;padding:20px;border-radius:14px;
  background:rgba(255,45,120,0.03);
  border:1px solid rgba(255,45,120,0.20);
  margin-bottom:20px;overflow:hidden;
  transition:all 200ms cubic-bezier(0.16,1,0.3,1);
}
.hero:hover{background:rgba(255,45,120,0.06);border-color:rgba(255,45,120,0.3);transform:translateY(-1px);box-shadow:0 8px 24px rgba(0,0,0,0.3);}
.hero::after{
  content:'';position:absolute;top:-40px;right:-40px;width:120px;height:120px;
  background:radial-gradient(circle,rgba(255,45,120,0.08) 0%,transparent 70%);
  pointer-events:none;
}
.hero-inner{display:grid;grid-template-columns:300px 1fr;gap:20px;}
.hero-left{position:relative;z-index:1;}
.hero-label{
  font-family:var(--font-mono);font-size:10px;text-transform:uppercase;
  letter-spacing:0.06em;color:var(--text-3);margin-bottom:8px;
  display:flex;align-items:center;gap:8px;
}
.hero-label .critical-tag{
  font-family:var(--font-mono);font-size:9px;padding:3px 8px;border-radius:6px;
  background:var(--thermal-dim);color:var(--thermal);border:1px solid rgba(255,45,120,0.2);
}
.hero-value{
  font-family:var(--font-display);font-size:52px;font-weight:400;
  letter-spacing:-0.04em;line-height:1;color:var(--text-1);
  text-shadow:0 0 60px rgba(255,45,120,0.3);
}
.hero-delta{
  font-family:var(--font-mono);font-size:11px;color:var(--thermal);
  margin-top:8px;display:flex;align-items:center;gap:4px;
}
.hero-sparkline{position:relative;z-index:1;margin-top:12px;}
.hero-sparkline canvas{display:block;}
.hero-right{
  display:grid;grid-template-columns:1fr 1fr;gap:8px;
  position:relative;z-index:1;align-content:start;
}
.hero-seg{
  padding:8px 10px;border-radius:8px;
  background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);
  transition:all 0.2s;cursor:pointer;
}
.hero-seg:hover{background:rgba(255,255,255,0.06);border-color:rgba(255,255,255,0.1);}
.hero-seg-label{font-family:var(--font-mono);font-size:8px;color:var(--text-4);text-transform:uppercase;letter-spacing:0.06em;margin-bottom:4px;}
.hero-seg-val{font-family:var(--font-display);font-size:16px;font-weight:400;letter-spacing:-0.02em;}
.hero-seg-delta{font-family:var(--font-mono);font-size:9px;margin-top:2px;}

/* ═══════════════════════════════════════════
   TRACKER GRID (Monitor)
   ═══════════════════════════════════════════ */
.tracker-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px;}
.tracker-card{
  padding:16px 18px;border-radius:12px;
  background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);
  transition:all 200ms cubic-bezier(0.16,1,0.3,1);cursor:pointer;
}
.tracker-card:hover{background:rgba(255,255,255,0.04);transform:translateY(-2px);border-color:rgba(255,255,255,0.12);box-shadow:0 8px 32px rgba(0,0,0,0.3);}
.tracker-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:10px;}
.tracker-label{font-family:var(--font-mono);font-size:10px;text-transform:uppercase;letter-spacing:0.06em;color:var(--text-3);}
.tracker-source-tag{
  font-family:var(--font-mono);font-size:8px;padding:2px 7px;border-radius:5px;
  text-transform:uppercase;letter-spacing:0.06em;
}
.tracker-value{font-family:var(--font-display);font-size:32px;font-weight:400;letter-spacing:-0.03em;line-height:1;}
.tracker-delta{font-family:var(--font-mono);font-size:10px;margin-top:2px;display:flex;align-items:center;gap:3px;}
.tracker-delta.down{color:var(--thermal);}
.tracker-delta.up{color:var(--aurora);}
.tracker-delta.flat{color:var(--amber);}
.tracker-sparkline{margin:12px 0 10px;height:32px;}
.tracker-sparkline canvas{display:block;width:100%;height:100%;}
.tracker-segments{display:flex;gap:3px;margin-bottom:10px;}
.tracker-seg-bar{height:4px;border-radius:2px;opacity:0.7;transition:flex 800ms cubic-bezier(0.16,1,0.3,1);flex:0;}
.tracker-comp{
  display:flex;align-items:center;justify-content:space-between;
  padding-top:10px;border-top:1px solid var(--wire);
  font-family:var(--font-mono);font-size:9px;color:var(--text-4);
}
.tracker-comp-val{color:var(--text-2);}

/* ═══════════════════════════════════════════
   SECTION TITLE
   ═══════════════════════════════════════════ */
.sec-title{
  font-family:var(--font-mono);font-size:10px;color:var(--text-4);
  text-transform:uppercase;letter-spacing:0.08em;
  margin-bottom:12px;margin-top:4px;
}

/* ═══════════════════════════════════════════
   INTELLIGENCE PULSE
   ═══════════════════════════════════════════ */
.pulse-list{margin-bottom:24px;}
.pulse-item{
  padding:10px 12px;border-radius:10px;
  display:flex;align-items:center;gap:12px;
  transition:background 120ms;cursor:pointer;
}
.pulse-item:hover{background:rgba(255,255,255,0.03);}
.pulse-item+.pulse-item{border-top:1px solid rgba(255,255,255,0.05);}
.pulse-severity{
  font-family:var(--font-mono);font-size:9px;text-transform:uppercase;
  letter-spacing:0.05em;padding:3px 8px;border-radius:6px;
  flex-shrink:0;font-weight:500;min-width:80px;text-align:center;
  border:1px solid;
}
.pulse-severity.critical{background:var(--thermal-dim);color:var(--thermal);border-color:rgba(255,45,120,0.2);}
.pulse-severity.warning{background:var(--amber-dim);color:var(--amber);border-color:rgba(251,191,36,0.2);}
.pulse-severity.watch{background:var(--blue-dim);color:var(--blue);border-color:rgba(96,165,250,0.2);}
.pulse-body{flex:1;min-width:0;}
.pulse-text{font-size:13px;color:var(--text-2);line-height:1.45;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.pulse-text strong{color:var(--text-1);font-weight:600;}
.pulse-meta{display:flex;align-items:center;gap:6px;margin-top:4px;flex-wrap:wrap;}
.pulse-source-tag{
  font-family:var(--font-mono);font-size:7px;padding:1px 5px;border-radius:3px;
  border:1px solid;color:var(--text-3);text-transform:uppercase;letter-spacing:0.04em;
}
.pulse-source-tag.social{border-color:rgba(123,47,190,0.2);color:var(--violet-g);}
.pulse-source-tag.news{border-color:rgba(96,165,250,0.2);color:var(--blue);}
.pulse-source-tag.reviews{border-color:rgba(14,243,197,0.15);color:var(--aurora);}
.pulse-source-tag.trends{border-color:rgba(251,191,36,0.2);color:var(--amber);}
.pulse-source-tag.regulatory{border-color:rgba(255,45,120,0.15);color:var(--thermal);}
.pulse-source-tag.appintel{border-color:rgba(96,165,250,0.15);color:var(--blue);}
.pulse-source-tag.research{border-color:rgba(14,243,197,0.2);color:var(--aurora);}
.pulse-time{font-family:var(--font-mono);font-size:9px;color:var(--text-5);white-space:nowrap;flex-shrink:0;}
.pulse-arrow{font-family:var(--font-mono);font-size:10px;color:var(--aurora);opacity:0;transition:opacity 120ms;flex-shrink:0;}
.pulse-item:hover .pulse-arrow{opacity:1;}

/* ═══════════════════════════════════════════
   BOTTOM GRID (Watchlist preview + Engine)
   ═══════════════════════════════════════════ */
.bottom-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.mini-watchlist-item{
  display:flex;align-items:center;gap:10px;
  padding:10px 12px;border-radius:8px;
  background:rgba(255,255,255,0.02);border:1px solid var(--wire);
  margin-bottom:5px;font-size:12px;transition:all 0.2s;cursor:pointer;
}
.mini-watchlist-item:hover{background:rgba(255,255,255,0.04);transform:translateY(-2px);border-color:rgba(255,255,255,0.12);box-shadow:0 8px 32px rgba(0,0,0,0.3);}
.mini-w-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.mini-w-dot.high{background:var(--thermal);}
.mini-w-dot.med{background:var(--amber);}
.mini-w-dot.low{background:var(--aurora);}
.mini-w-name{flex:1;color:var(--text-2);font-weight:500;}
.mini-w-stat{font-family:var(--font-mono);font-size:9px;color:var(--text-3);}
.mini-w-delta{font-family:var(--font-mono);font-size:9px;}
.engine-item{
  display:flex;align-items:center;gap:10px;
  padding:8px 12px;border-radius:8px;margin-bottom:4px;
  font-family:var(--font-mono);font-size:10px;color:var(--text-3);
}
.engine-dot{width:5px;height:5px;border-radius:50%;flex-shrink:0;}
.engine-time{margin-left:auto;font-size:9px;color:var(--text-5);}

/* ═══════════════════════════════════════════
   CONVERSATION BAR (bottom pinned)
   ═══════════════════════════════════════════ */
.convo-bar{
  position:fixed;bottom:0;left:var(--rail-w);right:0;z-index:200;
  padding:16px 32px 24px;
  background:linear-gradient(to top,var(--bg) 60%,transparent);
}
.convo-bar-inner{
  display:flex;align-items:center;gap:10px;
  padding:14px 20px;border-radius:16px;
  background:rgba(255,255,255,0.04);
  backdrop-filter:blur(16px) saturate(160%);
  border:1.5px solid rgba(255,255,255,0.12);
  transition:all 300ms cubic-bezier(0.16,1,0.3,1);
  box-shadow:0 8px 32px rgba(0,0,0,0.3);cursor:text;
  max-width:720px;margin:0 auto 12px;
}
.convo-bar-inner:focus-within{
  border-color:rgba(14,243,197,0.4);background:rgba(255,255,255,0.06);
  box-shadow:0 0 0 4px rgba(14,243,197,0.08),0 0 32px rgba(14,243,197,0.06);
}
.convo-icon{
  width:28px;height:28px;border-radius:9px;flex-shrink:0;
  background:linear-gradient(135deg,var(--violet),var(--violet-g));
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 0 12px rgba(123,47,190,0.3);
}
.convo-icon svg{width:16px;height:16px;color:white;}
.convo-input{
  flex:1;background:none;border:none;outline:none;
  font-family:var(--font-body);font-size:15px;color:var(--text-1);
}
.convo-input::placeholder{color:var(--text-3);}
.convo-kbd{
  font-family:var(--font-mono);font-size:10px;color:var(--text-5);
  padding:3px 7px;border-radius:5px;border:1px solid var(--wire2);
  flex-shrink:0;
}
.convo-send{
  width:34px;height:34px;border-radius:11px;border:1px solid var(--wire2);
  background:var(--s2);color:var(--text-3);cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  transition:all 0.2s;flex-shrink:0;
}
.convo-send:hover{background:var(--violet);border-color:var(--violet);color:white;box-shadow:0 0 16px rgba(123,47,190,0.3);}
.convo-send svg{width:16px;height:16px;}
.convo-chip{
  font-family:var(--font-mono);font-size:10px;color:var(--text-3);
  padding:6px 14px;border-radius:999px;
  border:1px solid var(--wire2);
  cursor:pointer;transition:all 0.2s;background:transparent;
}
.convo-chip:hover{border-color:rgba(14,243,197,0.3);color:var(--aurora);background:rgba(14,243,197,0.04);}

/* ═══════════════════════════════════════════
   CONVERSATIONS VIEW
   ═══════════════════════════════════════════ */
.conv-layout{display:flex;height:calc(100vh - 48px - 24px);margin:-24px -32px;position:relative;}
.conv-sidebar{
  width:260px;border-right:1px solid var(--wire);
  background:rgba(17,17,24,0.4);padding:16px;
  overflow-y:auto;flex-shrink:0;
}
.conv-sidebar-title{
  font-family:var(--font-mono);font-size:9px;color:var(--text-4);
  text-transform:uppercase;letter-spacing:0.08em;margin-bottom:12px;
}
.conv-thread{
  padding:8px 10px;border-radius:10px;cursor:pointer;margin-bottom:4px;
  border:1px solid transparent;transition:all 0.15s;
}
.conv-thread:hover{background:rgba(255,255,255,0.04);}
.conv-thread.active{background:rgba(14,243,197,0.05);border-color:rgba(14,243,197,0.1);}
.conv-thread-title{font-size:12px;font-weight:500;color:var(--text-1);margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.conv-thread-meta{font-family:var(--font-mono);font-size:9px;color:var(--text-4);}
.conv-center{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.conv-messages{flex:1;overflow-y:auto;padding:24px 32px;}
.conv-input-area{padding:16px 24px;border-top:1px solid var(--wire);}
.conv-input-row{display:flex;gap:10px;}
.conv-text-input{
  flex:1;padding:12px 16px;border-radius:10px;
  background:rgba(255,255,255,0.04);border:1px solid var(--wire2);
  color:var(--text-1);font-family:var(--font-body);font-size:13px;
  outline:none;transition:border-color 0.2s;
}
.conv-text-input:focus{border-color:rgba(123,47,190,0.3);}
.conv-text-input::placeholder{color:var(--text-5);}
.conv-send-btn{
  padding:12px 20px;border-radius:10px;border:none;
  background:var(--violet);color:white;font-family:var(--font-body);
  font-size:13px;font-weight:500;cursor:pointer;transition:all 0.2s;
}
.conv-send-btn:hover{background:var(--violet-g);}
.conv-context{
  width:280px;border-left:1px solid var(--wire);
  background:rgba(17,17,24,0.4);padding:16px;
  overflow-y:auto;flex-shrink:0;
}
.conv-context-section{margin-bottom:20px;}
.conv-context-title{
  font-family:var(--font-mono);font-size:9px;color:var(--text-4);
  text-transform:uppercase;letter-spacing:0.08em;margin-bottom:10px;
}
.msg{max-width:760px;margin:0 auto 28px;display:flex;gap:10px;animation:msgIn 400ms ease;}
@keyframes msgIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.thinking-dots{display:flex;gap:4px;padding:8px 0;}
.thinking-dots span{width:6px;height:6px;border-radius:50%;background:var(--violet-g);animation:dotPulse 1.4s ease-in-out infinite;}
.thinking-dots span:nth-child(2){animation-delay:0.2s;}
.thinking-dots span:nth-child(3){animation-delay:0.4s;}
@keyframes dotPulse{0%,100%{opacity:0.3;transform:scale(0.8)}50%{opacity:1;transform:scale(1)}}
.msg.user{flex-direction:row-reverse;}
.msg-avatar{
  width:28px;height:28px;border-radius:9px;
  display:flex;align-items:center;justify-content:center;
  font-size:11px;font-weight:500;flex-shrink:0;
}
.msg.ai .msg-avatar{background:linear-gradient(135deg,var(--violet),var(--violet-g));color:white;}
.msg.user .msg-avatar{background:linear-gradient(135deg,#00B14F,#008f3f);color:white;}
.msg-bubble{
  font-size:14px;line-height:1.75;padding-left:0;color:var(--text-2);
}
.msg.ai .msg-bubble{color:var(--text-2);}
.msg.user .msg-bubble{color:var(--text-1);}
.msg-bubble strong{color:var(--text-1);font-weight:600;}
.msg-cite{
  font-family:var(--font-mono);font-size:9px;color:var(--violet-g);
  background:rgba(123,47,190,0.08);padding:2px 6px;border-radius:4px;
  display:inline-block;margin-top:4px;
}
.msg-confidence{
  display:inline-flex;align-items:center;gap:4px;margin-top:6px;
  font-family:var(--font-mono);font-size:9px;color:var(--aurora);
  background:var(--aurora-dim);padding:3px 8px;border-radius:4px;
}
/* context panel items */
.ctx-source{
  display:flex;align-items:center;gap:6px;
  padding:6px 8px;border-radius:6px;margin-bottom:4px;
  font-size:11px;color:var(--text-2);
  background:rgba(255,255,255,0.02);
}
.ctx-source-dot{width:5px;height:5px;border-radius:50%;background:var(--aurora);}
.ctx-metric{
  display:flex;justify-content:space-between;align-items:center;
  padding:6px 0;border-bottom:1px solid var(--wire);
  font-size:11px;
}
.ctx-metric-label{color:var(--text-3);font-family:var(--font-mono);font-size:9px;}
.ctx-metric-val{font-family:var(--font-display);font-weight:600;color:var(--text-1);}
.ctx-tag{
  display:inline-block;font-family:var(--font-mono);font-size:8px;
  padding:3px 7px;border-radius:4px;margin:2px 2px 2px 0;
  background:rgba(255,255,255,0.04);border:1px solid var(--wire);color:var(--text-3);
}
.ctx-action{
  display:block;width:100%;text-align:left;
  padding:7px 12px;border-radius:8px;margin-bottom:4px;
  background:transparent;border:1px solid var(--wire2);
  color:var(--text-3);font-size:10px;cursor:pointer;
  font-family:var(--font-mono);transition:all 0.15s;text-transform:uppercase;letter-spacing:0.04em;
}
.ctx-action:hover{border-color:rgba(14,243,197,0.3);color:var(--aurora);background:rgba(14,243,197,0.04);}

/* ═══════════════════════════════════════════
   SOCIAL LISTENING VIEW
   ═══════════════════════════════════════════ */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;}
.stat-card{
  padding:18px;border-radius:12px;
  background:var(--glass-bg);border:1px solid var(--glass-border);
  backdrop-filter:blur(12px) saturate(150%);
}
.stat-label{font-family:var(--font-mono);font-size:8px;text-transform:uppercase;letter-spacing:0.06em;color:var(--text-3);margin-bottom:6px;}
.stat-val{font-family:var(--font-display);font-size:26px;font-weight:600;letter-spacing:-0.02em;}
.stat-sub{font-family:var(--font-mono);font-size:9px;color:var(--text-4);margin-top:3px;}
.feed-list{max-height:calc(100vh - 340px);overflow-y:auto;}
.feed-item{
  padding:14px 18px;border-radius:0;
  background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,0.05);
  transition:background 120ms;cursor:pointer;
}
.feed-item:hover{background:rgba(255,255,255,0.03);}
.feed-item:last-child{border-bottom:none;}
.feed-head{display:flex;align-items:center;gap:8px;margin-bottom:6px;}
.feed-platform{
  font-family:var(--font-mono);font-size:8px;text-transform:uppercase;
  letter-spacing:0.04em;padding:3px 7px;border-radius:4px;font-weight:500;
}
.feed-platform.twitter{background:rgba(96,165,250,0.1);color:var(--blue);border:1px solid rgba(96,165,250,0.15);}
.feed-platform.tiktok{background:rgba(14,243,197,0.08);color:var(--aurora);border:1px solid rgba(14,243,197,0.12);}
.feed-platform.kaskus{background:rgba(251,191,36,0.08);color:var(--amber);border:1px solid rgba(251,191,36,0.12);}
.feed-platform.instagram{background:rgba(123,47,190,0.1);color:var(--violet-g);border:1px solid rgba(123,47,190,0.15);}
.feed-user{font-family:var(--font-mono);font-size:9px;color:var(--text-4);}
.feed-text{font-size:13px;color:var(--text-2);line-height:1.55;margin-bottom:8px;}
.feed-bottom{display:flex;align-items:center;gap:10px;}
.feed-sentiment{
  font-family:var(--font-mono);font-size:8px;padding:3px 8px;border-radius:4px;
  text-transform:uppercase;letter-spacing:0.04em;
}
.feed-sentiment.pos{background:var(--aurora-dim);color:var(--aurora);border:1px solid rgba(14,243,197,0.15);}
.feed-sentiment.neg{background:var(--thermal-dim);color:var(--thermal);border:1px solid rgba(255,45,120,0.15);}
.feed-sentiment.neu{background:rgba(255,255,255,0.04);color:var(--text-3);border:1px solid var(--wire);}
.feed-engagement{font-family:var(--font-mono);font-size:9px;color:var(--text-4);display:flex;gap:10px;}

/* ═══════════════════════════════════════════
   NEWS VIEW
   ═══════════════════════════════════════════ */
.news-list{display:flex;flex-direction:column;gap:8px;}
.news-card{
  padding:14px 18px;border-radius:0;
  background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,0.05);
  display:flex;gap:14px;align-items:flex-start;
  transition:background 120ms;cursor:pointer;
}
.news-card:hover{background:rgba(255,255,255,0.03);}
.news-card:last-child{border-bottom:none;}
.news-type-badge{
  font-family:var(--font-mono);font-size:7px;text-transform:uppercase;
  letter-spacing:0.06em;padding:4px 8px;border-radius:5px;white-space:nowrap;
  flex-shrink:0;margin-top:2px;font-weight:500;
}
.news-type-badge.regulatory{background:var(--thermal-dim);color:var(--thermal);border:1px solid rgba(255,45,120,0.15);}
.news-type-badge.competitive{background:var(--blue-dim);color:var(--blue);border:1px solid rgba(96,165,250,0.15);}
.news-type-badge.industry{background:var(--amber-dim);color:var(--amber);border:1px solid rgba(251,191,36,0.15);}
.news-body{flex:1;min-width:0;}
.news-title{font-size:13px;font-weight:500;color:var(--text-1);margin-bottom:4px;line-height:1.4;}
.news-summary{font-size:11px;color:var(--text-3);line-height:1.5;margin-bottom:6px;}
.news-meta{font-family:var(--font-mono);font-size:8px;color:var(--text-5);display:flex;gap:10px;}
.news-impact{
  font-family:var(--font-mono);font-size:7px;padding:2px 6px;border-radius:3px;
  text-transform:uppercase;letter-spacing:0.04em;
}
.news-impact.high{background:var(--thermal-dim);color:var(--thermal);}
.news-impact.medium{background:var(--amber-dim);color:var(--amber);}
.news-impact.low{background:rgba(255,255,255,0.04);color:var(--text-4);}

/* ═══════════════════════════════════════════
   TRACKERS VIEW
   ═══════════════════════════════════════════ */
.trackers-detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.tracker-detail-card{
  padding:20px;border-radius:14px;
  background:rgba(255,255,255,0.03);border:1px solid var(--wire2);
  backdrop-filter:blur(12px) saturate(150%);
  transition:all 200ms cubic-bezier(0.16,1,0.3,1);
}
.tracker-detail-card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,0.15);}
.td-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px;}
.td-label{font-family:var(--font-mono);font-size:10px;text-transform:uppercase;letter-spacing:0.06em;color:var(--text-3);}
.td-value{font-family:var(--font-display);font-size:40px;font-weight:700;letter-spacing:-0.03em;margin-bottom:4px;}
.td-delta{font-family:var(--font-mono);font-size:11px;}
.td-sparkline{height:48px;margin:16px 0;}
.td-sparkline canvas{width:100%;height:100%;display:block;}
.td-formula{margin-top:14px;padding-top:14px;border-top:1px solid var(--wire);}
.td-formula-title{font-family:var(--font-mono);font-size:8px;color:var(--text-4);text-transform:uppercase;letter-spacing:0.06em;margin-bottom:8px;}
.td-formula-item{
  display:flex;align-items:center;gap:8px;
  padding:5px 0;font-size:11px;color:var(--text-3);
}
.td-formula-dot{width:6px;height:6px;border-radius:2px;flex-shrink:0;}
.td-formula-pct{font-family:var(--font-mono);font-size:10px;color:var(--text-2);margin-left:auto;}

/* ═══════════════════════════════════════════
   RESEARCH VIEW
   ═══════════════════════════════════════════ */
.research-launchers{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:28px;}
.research-launch-btn{
  padding:16px 20px;border-radius:14px;
  background:rgba(255,255,255,0.03);border:1px solid var(--wire2);
  cursor:pointer;transition:all 200ms cubic-bezier(0.16,1,0.3,1);text-align:center;
}
.research-launch-btn:hover{background:rgba(255,255,255,0.05);border-color:var(--violet-dim);transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,0.2);}
.research-launch-icon{margin-bottom:8px;}
.research-launch-icon svg{width:32px;height:32px;color:var(--violet-g);}
.research-launch-title{font-family:var(--font-display);font-size:16px;font-weight:600;margin-bottom:6px;}
.research-launch-desc{font-size:12px;color:var(--text-3);line-height:1.5;}
.research-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;}
.research-card{
  padding:18px;border-radius:12px;
  background:var(--glass-bg);border:1px solid var(--glass-border);
  transition:all 0.2s;cursor:pointer;
}
.research-card:hover{background:var(--glass-hover);border-color:var(--glass-hover-border);}
.research-card-title{font-size:13px;font-weight:500;color:var(--text-1);margin-bottom:8px;}
.research-status{
  display:inline-block;font-family:var(--font-mono);font-size:8px;
  padding:3px 7px;border-radius:4px;text-transform:uppercase;letter-spacing:0.04em;
  margin-bottom:8px;
}
.research-status.complete{background:var(--aurora-dim);color:var(--aurora);border:1px solid rgba(14,243,197,0.15);}
.research-status.active{background:var(--blue-dim);color:var(--blue);border:1px solid rgba(96,165,250,0.15);}
.research-status.planned{background:rgba(255,255,255,0.04);color:var(--text-4);border:1px solid var(--wire);}
.research-stats{font-family:var(--font-mono);font-size:9px;color:var(--text-4);margin-bottom:6px;}
.research-tags{display:flex;gap:4px;flex-wrap:wrap;}
.research-tag{
  font-family:var(--font-mono);font-size:7px;padding:2px 6px;border-radius:3px;
  background:rgba(255,255,255,0.03);border:1px solid var(--wire);color:var(--text-4);
  text-transform:uppercase;letter-spacing:0.04em;
}

/* ═══════════════════════════════════════════
   WATCHLIST VIEW
   ═══════════════════════════════════════════ */
.watchlist-grid{display:flex;flex-direction:column;gap:10px;}
.watchlist-card{
  padding:18px 20px;border-radius:12px;
  background:var(--glass-bg);border:1px solid var(--glass-border);
  backdrop-filter:blur(12px) saturate(150%);
  transition:all 0.2s;
}
.watchlist-card:hover{background:var(--glass-hover);border-color:var(--glass-hover-border);}
.wl-header{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.wl-severity{
  font-family:var(--font-mono);font-size:7px;padding:3px 7px;border-radius:4px;
  text-transform:uppercase;letter-spacing:0.04em;font-weight:500;flex-shrink:0;
}
.wl-severity.critical{background:var(--thermal-dim);color:var(--thermal);border:1px solid rgba(255,45,120,0.2);}
.wl-severity.warning{background:var(--amber-dim);color:var(--amber);border:1px solid rgba(251,191,36,0.2);}
.wl-severity.watch{background:var(--blue-dim);color:var(--blue);border:1px solid rgba(96,165,250,0.2);}
.wl-title{font-size:14px;font-weight:500;color:var(--text-1);}
.wl-triggers{font-family:var(--font-mono);font-size:9px;color:var(--text-4);margin-left:auto;}
.wl-desc{font-size:12px;color:var(--text-3);line-height:1.5;margin-bottom:12px;}
.wl-stats{display:flex;gap:16px;flex-wrap:wrap;}
.wl-stat{
  padding:8px 12px;border-radius:6px;
  background:rgba(255,255,255,0.02);border:1px solid var(--wire);
}
.wl-stat-label{font-family:var(--font-mono);font-size:7px;color:var(--text-4);text-transform:uppercase;letter-spacing:0.04em;margin-bottom:3px;}
.wl-stat-val{font-family:var(--font-display);font-size:16px;font-weight:600;color:var(--text-1);}
.wl-stat-delta{font-family:var(--font-mono);font-size:8px;margin-top:2px;}

/* ═══════════════════════════════════════════
   COMMAND PALETTE
   ═══════════════════════════════════════════ */
.cmd-overlay{
  position:fixed;inset:0;z-index:9999;
  background:rgba(0,0,0,0.6);backdrop-filter:blur(8px);
  display:flex;align-items:flex-start;justify-content:center;
  padding-top:18vh;
  opacity:0;pointer-events:none;transition:opacity 200ms ease;
}
.cmd-overlay.open{opacity:1;pointer-events:auto;}
.cmd-box{
  width:520px;max-height:420px;border-radius:16px;
  background:rgba(26,26,37,0.95);backdrop-filter:blur(24px) saturate(180%);
  border:1px solid rgba(255,255,255,0.1);
  box-shadow:0 24px 80px rgba(0,0,0,0.5);
  display:flex;flex-direction:column;overflow:hidden;
  transform:scale(0.96) translateY(-8px);transition:transform 200ms cubic-bezier(0.16,1,0.3,1);
}
.cmd-overlay.open .cmd-box{transform:scale(1) translateY(0);}
.cmd-input-wrap{
  display:flex;align-items:center;gap:10px;padding:16px 20px;
  border-bottom:1px solid rgba(255,255,255,0.06);
}
.cmd-input-wrap svg{width:16px;height:16px;color:var(--text-3);flex-shrink:0;}
.cmd-input{
  flex:1;background:none;border:none;outline:none;
  font-family:var(--font-body);font-size:15px;color:var(--text-1);
}
.cmd-input::placeholder{color:var(--text-4);}
.cmd-esc{
  font-family:var(--font-mono);font-size:9px;color:var(--text-5);
  padding:2px 6px;border-radius:4px;border:1px solid rgba(255,255,255,0.06);
}
.cmd-results{flex:1;overflow-y:auto;padding:8px;}
.cmd-results::-webkit-scrollbar{width:4px;}
.cmd-results::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.08);border-radius:2px;}
.cmd-result{
  display:flex;align-items:center;gap:10px;
  padding:8px 12px;border-radius:8px;cursor:pointer;
  transition:background 80ms;
}
.cmd-result:hover,.cmd-result.active,.cmd-result.selected{background:rgba(255,255,255,0.06);}
.cmd-result-icon{
  width:24px;height:24px;border-radius:6px;
  display:flex;align-items:center;justify-content:center;
  font-size:10px;flex-shrink:0;
}
.cmd-result-icon.nav{background:var(--aurora-dim);color:var(--aurora);}
.cmd-result-icon.tracker{background:var(--violet-dim);color:var(--violet-g);}
.cmd-result-icon.pulse{background:var(--thermal-dim);color:var(--thermal);}
.cmd-result-icon.watchlist{background:var(--amber-dim);color:var(--amber);}
.cmd-result-text{flex:1;min-width:0;}
.cmd-result-label{font-size:13px;color:var(--text-2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.cmd-result-type{font-family:var(--font-mono);font-size:9px;color:var(--text-4);text-transform:uppercase;letter-spacing:0.04em;margin-top:1px;}
.cmd-result-meta{font-family:var(--font-mono);font-size:9px;color:var(--text-4);text-transform:uppercase;letter-spacing:0.04em;}
.cmd-empty{padding:24px;text-align:center;font-size:12px;color:var(--text-4);}

/* ═══════════════════════════════════════════
   TRACKER TOOLTIP
   ═══════════════════════════════════════════ */
.trk-tip{
  position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);
  padding:10px 14px;border-radius:10px;
  background:rgba(26,26,37,0.95);backdrop-filter:blur(16px);
  border:1px solid rgba(255,255,255,0.1);
  box-shadow:0 8px 24px rgba(0,0,0,0.4);
  white-space:nowrap;pointer-events:none;
  opacity:0;transition:opacity 150ms;z-index:100;
}
.tracker-card:hover .trk-tip{opacity:1;}
.trk-tip-title{font-family:var(--font-mono);font-size:8px;color:var(--text-4);text-transform:uppercase;letter-spacing:0.04em;margin-bottom:6px;}
.trk-tip-row{display:flex;gap:12px;margin-bottom:3px;}
.trk-tip-pt{font-family:var(--font-mono);font-size:10px;color:var(--text-2);}
.trk-tip-src{font-family:var(--font-mono);font-size:8px;color:var(--text-4);margin-top:4px;padding-top:4px;border-top:1px solid rgba(255,255,255,0.06);}

/* ═══════════════════════════════════════════
   CHIP ROTATION
   ═══════════════════════════════════════════ */
.convo-chips{position:relative;min-height:28px;}
.chip-set{
  display:flex;gap:8px;justify-content:center;flex-wrap:wrap;
  transition:opacity 0.5s ease;position:absolute;width:100%;
}
.chip-set.hidden{opacity:0;pointer-events:none;}
.chip-set.visible{opacity:1;pointer-events:auto;}
</style>
</head>
<body>

<!-- ═══════════════════════════════════════════
     HEADER
     ═══════════════════════════════════════════ -->
<header class="header">
  <div class="header-brand">
    <div class="hci"></div>
  </div>
  <div class="header-title">ClarityOS</div>
  <div class="header-client">Grab Indonesia</div>
  <div class="header-right">
    <div class="header-datetime" id="headerTime">Feb 20, 2026 · 10:34 AM</div>
    <div class="header-live"><div class="header-live-dot"></div>7 sources live</div>
    <div class="header-alerts">
      <div class="alert-dot"></div>
      3 Alerts
    </div>
  </div>
</header>

<!-- ═══════════════════════════════════════════
     SHELL: RAIL + MAIN
     ═══════════════════════════════════════════ -->
<div class="shell">
  <!-- ICON RAIL -->
  <nav class="rail">
    <div class="rail-logo"><span>C</span></div>
    <div class="rail-item active" data-view="monitor">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/></svg>
      <span class="rail-tooltip">Monitor</span>
    </div>
    <div class="rail-item" data-view="conversations">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
      <span class="rail-tooltip">Conversations</span>
    </div>
    <div class="rail-sep"></div>
    <div class="rail-item" data-view="trackers">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
      <span class="rail-tooltip">Trackers</span>
    </div>
    <div class="rail-item" data-view="research">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M9 3h6v7l3 2v2H6v-2l3-2V3z"/><path d="M10 17v4"/><path d="M14 17v4"/><circle cx="12" cy="3" r="0.5" fill="currentColor"/></svg>
      <span class="rail-tooltip">Research</span>
    </div>
    <div class="rail-item" data-view="social">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12 12m-2 0a2 2 0 1 0 4 0 2 2 0 1 0-4 0"/><path d="M12 5a7 7 0 0 1 7 7"/><path d="M5 12a7 7 0 0 1 7-7"/><path d="M12 19a7 7 0 0 1-7-7"/><path d="M19 12a7 7 0 0 1-7 7"/></svg>
      <span class="rail-tooltip">Social Listening</span>
    </div>
    <div class="rail-item" data-view="news">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
      <span class="rail-tooltip">News & Regulatory</span>
    </div>
    <div class="rail-item" data-view="watchlist">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
      <span class="rail-tooltip">Watchlist</span>
    </div>
    <div class="rail-bottom">
      <div class="rail-avatar"><span>GR</span></div>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <div class="main">

    <!-- ═══════════════════════════════════════
         MONITOR VIEW
         ═══════════════════════════════════════ -->
    <div class="view active" id="view-monitor">

      <!-- Source Bar -->
      <div class="source-bar">
        <span class="source-bar-label">Sources</span>
        <span class="source-pill" onclick="switchView('social')"><span class="source-dot streaming"></span>Brand24 Social</span>
        <span class="source-pill" onclick="switchView('social')"><span class="source-dot streaming"></span>AppFollow Reviews</span>
        <span class="source-pill" onclick="switchView('news')"><span class="source-dot streaming"></span>Event Registry News</span>
        <span class="source-pill" onclick="switchView('trackers')"><span class="source-dot streaming"></span>SerpAPI Trends</span>
        <span class="source-pill" onclick="switchView('research')"><span class="source-dot daily"></span>Quant Research</span>
        <span class="source-pill" onclick="switchView('research')"><span class="source-dot daily"></span>Qual Research</span>
        <span class="source-pill" onclick="switchView('trackers')"><span class="source-dot streaming"></span>App Intelligence</span>
      </div>

      <!-- NPS Hero Card -->
      <div class="hero">
        <div class="hero-inner">
          <div class="hero-left">
            <div class="hero-label">Consumer NPS <span class="critical-tag">Critical</span></div>
            <div class="hero-value">31</div>
            <div class="hero-delta">↓ 3 pts vs last month · lowest since Mar 2025</div>
            <div class="hero-sparkline"><canvas id="heroSparkline" width="280" height="80"></canvas></div>
          </div>
          <div class="hero-right">
            <div class="hero-seg">
              <div class="hero-seg-label">Jakarta NPS</div>
              <div class="hero-seg-val" style="color:var(--thermal)">28</div>
              <div class="hero-seg-delta" style="color:var(--thermal)">↓ 5 pts</div>
            </div>
            <div class="hero-seg">
              <div class="hero-seg-label">Gen Z NPS</div>
              <div class="hero-seg-val" style="color:var(--thermal)">22</div>
              <div class="hero-seg-delta" style="color:var(--thermal)">↓ 8 pts</div>
            </div>
            <div class="hero-seg">
              <div class="hero-seg-label">Gojek NPS</div>
              <div class="hero-seg-val" style="color:var(--aurora)">39</div>
              <div class="hero-seg-delta" style="color:var(--aurora)">↑ 2 pts</div>
            </div>
            <div class="hero-seg">
              <div class="hero-seg-label">Driver ↔ NPS Corr.</div>
              <div class="hero-seg-val" style="color:var(--amber)">0.78</div>
              <div class="hero-seg-delta" style="color:var(--amber)">Strong link</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tracker Grid -->
      <div class="tracker-grid" id="trackerGrid"></div>

      <!-- Intelligence Pulse -->
      <div class="sec-title">Intelligence Pulse</div>
      <div class="pulse-list" id="pulseList"></div>

      <!-- Bottom Grid -->
      <div class="sec-title">Overview</div>
      <div class="bottom-grid">
        <div class="card">
          <div class="sec-title" style="margin-top:0">Watchlist Preview</div>
          <div id="miniWatchlist"></div>
        </div>
        <div class="card">
          <div class="sec-title" style="margin-top:0">Engine Activity</div>
          <div id="engineLog"></div>
        </div>
      </div>
    </div>

    <!-- ═══════════════════════════════════════
         CONVERSATIONS VIEW
         ═══════════════════════════════════════ -->
    <div class="view" id="view-conversations">
      <div class="conv-layout">
        <!-- Left sidebar threads -->
        <div class="conv-sidebar">
          <div class="conv-sidebar-title">Today</div>
          <div class="conv-thread active">
            <div class="conv-thread-title">Why did NPS drop?</div>
            <div class="conv-thread-meta">4 sources · 12 min ago</div>
          </div>
          <div class="conv-thread">
            <div class="conv-thread-title">Gojek promo analysis</div>
            <div class="conv-thread-meta">3 sources · 2h ago</div>
          </div>
          <div class="conv-thread">
            <div class="conv-thread-title">Driver Pulse breakdown</div>
            <div class="conv-thread-meta">5 sources · 4h ago</div>
          </div>
          <div class="conv-sidebar-title" style="margin-top:16px">This Week</div>
          <div class="conv-thread">
            <div class="conv-thread-title">OJK regulation impact</div>
            <div class="conv-thread-meta">2 sources · Mon</div>
          </div>
          <div class="conv-thread">
            <div class="conv-thread-title">Gen Z segment deep dive</div>
            <div class="conv-thread-meta">6 sources · Mon</div>
          </div>
          <div class="conv-thread">
            <div class="conv-thread-title">ShopeeFood threat assessment</div>
            <div class="conv-thread-meta">4 sources · Sun</div>
          </div>
          <div class="conv-thread">
            <div class="conv-thread-title">Q1 research brief</div>
            <div class="conv-thread-meta">3 sources · Sat</div>
          </div>
        </div>

        <!-- Center chat -->
        <div class="conv-center">
          <div class="conv-messages" id="convMessages">
            <div class="msg user">
              <div class="msg-avatar">Y</div>
              <div class="msg-bubble">Why did NPS drop last week? What's driving it?</div>
            </div>
            <div class="msg ai">
              <div class="msg-avatar">C</div>
              <div class="msg-bubble">
                NPS dropped <strong>3 points to 31</strong> over the past 7 days. I've traced this across 4 data sources to three converging signals:
                <br><br>
                <strong>1. Commission cap backlash (primary driver)</strong><br>
                Social media mentions of "komisi" and "potongan" spiked <strong>340%</strong> on Twitter and Kaskus. Driver dissatisfaction is bleeding into consumer perception — riders report longer wait times and drivers refusing short trips. Brand24 flagged this as a critical trend 48h ago.
                <br><br>
                <strong>2. App store review deterioration</strong><br>
                Google Play rating dropped from <strong>4.4 → 4.1</strong> over the past 10 days. The top complaint cluster is "payment failed" (38% of 1-star reviews), followed by "driver cancelled" (24%). AppFollow data shows the payment bug was patched 2 days ago but review recovery typically lags 5-7 days.
                <br><br>
                <strong>3. Gojek promo offensive in Surabaya & Bandung</strong><br>
                Gojek launched aggressive <strong>40% GoCar discounts</strong>. Our Share of Voice in those cities dropped from 51% to 39% in one week. The Jan quant wave (n=1,200) shows price sensitivity is the #1 switching driver for the 18-24 segment.
                <br><br>
                <span class="msg-cite">Brand24 social feed</span>
                <span class="msg-cite">AppFollow reviews</span>
                <span class="msg-cite">SerpAPI trends</span>
                <span class="msg-cite">Jan 2026 quant wave (n=1,200)</span>
                <br>
                <span class="msg-confidence">
                  <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                  Confidence: 0.87 — high convergence across sources
                </span>
              </div>
            </div>
          </div>
          <div class="conv-input-area">
            <div class="conv-input-row">
              <input class="conv-text-input" placeholder="Ask ClarityOS anything about Grab Indonesia..." id="convInput">
              <button class="conv-send-btn" id="convSendBtn">Send</button>
            </div>
          </div>
        </div>

        <!-- Right context panel -->
        <div class="conv-context">
          <div class="conv-context-section">
            <div class="conv-context-title">Active Sources</div>
            <div class="ctx-source"><span class="ctx-source-dot"></span>Brand24 Social — streaming</div>
            <div class="ctx-source"><span class="ctx-source-dot"></span>AppFollow Reviews — streaming</div>
            <div class="ctx-source"><span class="ctx-source-dot"></span>SerpAPI Trends — streaming</div>
            <div class="ctx-source"><span class="ctx-source-dot" style="background:var(--blue)"></span>Quant Research — Jan wave</div>
          </div>
          <div class="conv-context-section">
            <div class="conv-context-title">Tracker Snapshot</div>
            <div class="ctx-metric"><span class="ctx-metric-label">Consumer NPS</span><span class="ctx-metric-val" style="color:var(--thermal)">31</span></div>
            <div class="ctx-metric"><span class="ctx-metric-label">Brand Equity</span><span class="ctx-metric-val">54</span></div>
            <div class="ctx-metric"><span class="ctx-metric-label">Driver Pulse</span><span class="ctx-metric-val" style="color:var(--thermal)">44%</span></div>
            <div class="ctx-metric"><span class="ctx-metric-label">Share of Voice</span><span class="ctx-metric-val">47%</span></div>
            <div class="ctx-metric" style="border:none"><span class="ctx-metric-label">Service Exp</span><span class="ctx-metric-val" style="color:var(--aurora)">68</span></div>
          </div>
          <div class="conv-context-section">
            <div class="conv-context-title">Active Topics</div>
            <span class="ctx-tag">NPS decline</span>
            <span class="ctx-tag">Commission backlash</span>
            <span class="ctx-tag">App reviews</span>
            <span class="ctx-tag">Gojek promos</span>
            <span class="ctx-tag">Gen Z churn</span>
            <span class="ctx-tag">Surabaya market</span>
          </div>
          <div class="conv-context-section">
            <div class="conv-context-title">Suggested Actions</div>
            <button class="ctx-action">📊 Launch Surabaya quant study</button>
            <button class="ctx-action">📋 Generate NPS topline report</button>
            <button class="ctx-action">🔔 Set driver pulse alert at 40%</button>
            <button class="ctx-action">📈 Compare with Gojek NPS trend</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ═══════════════════════════════════════
         SOCIAL LISTENING VIEW
         ═══════════════════════════════════════ -->
    <div class="view" id="view-social">
      <div class="stats-row" id="socialStats"></div>
      <div class="sec-title">Live Feed</div>
      <div class="feed-list" id="socialFeed"></div>
    </div>

    <!-- ═══════════════════════════════════════
         NEWS & REGULATORY VIEW
         ═══════════════════════════════════════ -->
    <div class="view" id="view-news">
      <div class="stats-row" id="newsStats"></div>
      <div class="sec-title">Latest — sorted by impact</div>
      <div class="news-list" id="newsList"></div>
    </div>

    <!-- ═══════════════════════════════════════
         TRACKERS VIEW
         ═══════════════════════════════════════ -->
    <div class="view" id="view-trackers">
      <div class="sec-title">Detailed Tracker Breakdown</div>
      <div class="trackers-detail-grid" id="trackersDetailGrid"></div>
    </div>

    <!-- ═══════════════════════════════════════
         RESEARCH VIEW
         ═══════════════════════════════════════ -->
    <div class="view" id="view-research">
      <div class="research-launchers">
        <div class="research-launch-btn" id="launchQuant">
          <div class="research-launch-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/><line x1="15" y1="3" x2="15" y2="21"/></svg>
          </div>
          <div class="research-launch-title">Launch Quant Study</div>
          <div class="research-launch-desc">Deploy survey to panel. Set quotas, screeners, and get statistically significant results in 48-72h.</div>
        </div>
        <div class="research-launch-btn" id="launchQual">
          <div class="research-launch-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          </div>
          <div class="research-launch-title">Launch Qual Study</div>
          <div class="research-launch-desc">AI-moderated depth interviews. Recruit from panel, auto-generate transcripts and thematic analysis.</div>
        </div>
      </div>
      <div class="sec-title">Past Research</div>
      <div class="research-grid" id="researchGrid"></div>
    </div>

    <!-- ═══════════════════════════════════════
         WATCHLIST VIEW
         ═══════════════════════════════════════ -->
    <div class="view" id="view-watchlist">
      <div class="sec-title">Monitored Issues</div>
      <div class="watchlist-grid" id="watchlistGrid"></div>
    </div>

  </div><!-- /main -->
</div><!-- /shell -->

<!-- CONVERSATION BAR (pinned bottom) -->
<div class="convo-bar" id="convoBar">
  <div class="convo-bar-inner">
    <div class="convo-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
    </div>
    <input class="convo-input" placeholder="Ask ClarityOS anything about Grab Indonesia..." id="globalInput">
    <span class="convo-kbd">⌘K</span>
    <button class="convo-send" id="globalSend">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
    </button>
  </div>
  <div class="convo-chips" id="chipContainer"></div>
</div>

<!-- COMMAND PALETTE -->
<div class="cmd-overlay" id="cmdOverlay">
  <div class="cmd-box">
    <div class="cmd-input-wrap">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input class="cmd-input" id="cmdInput" placeholder="Search trackers, views, alerts...">
      <span class="cmd-esc">ESC</span>
    </div>
    <div class="cmd-results" id="cmdResults"></div>
  </div>
</div>

<script>
/* ═══════════════════════════════════════════
   DATA
   ═══════════════════════════════════════════ */
const DATA = {
  trackers: [
    { label:'Brand Equity', value:'54', delta:'↓ 2.1 vs last month', dir:'down', color:'var(--thermal)',
      sparkData:[60,59,58,57,58,57,56,57,56,55,55,54],
      segments:[{c:'var(--violet)',w:35},{c:'var(--blue)',w:25},{c:'var(--aurora)',w:20},{c:'var(--amber)',w:20}],
      comp:'Gojek: 51', source:'4 sources' },
    { label:'Driver Pulse', value:'44%', delta:'↓ 6 pts vs last month', dir:'down', color:'var(--thermal)',
      sparkData:[62,60,58,55,53,52,50,48,50,48,47,44],
      segments:[{c:'var(--thermal)',w:40},{c:'var(--amber)',w:30},{c:'var(--aurora)',w:30}],
      comp:'Industry avg: 52%', source:'Research' },
    { label:'Share of Voice', value:'47%', delta:'↓ 2.1 vs last month', dir:'down', color:'var(--amber)',
      sparkData:[52,51,50,51,50,49,50,49,48,49,48,47],
      segments:[{c:'var(--violet)',w:47},{c:'var(--aurora)',w:36},{c:'var(--amber)',w:12},{c:'var(--text-5)',w:5}],
      comp:'Gojek: 36%', source:'Brand24' },
    { label:'Service Experience', value:'68', delta:'↑ 1.4 vs last month', dir:'up', color:'var(--aurora)',
      sparkData:[61,62,63,62,64,65,64,66,65,67,67,68],
      segments:[{c:'var(--aurora)',w:68},{c:'var(--blue)',w:20},{c:'var(--text-5)',w:12}],
      comp:'Gojek: 62', source:'Reviews' },
  ],
  pulse: [
    { severity:'critical', text:'<strong>Commission cap discussion surging</strong> — Twitter/Kaskus mentions up 340% in 48h. Driver forums show coordinated protest planning.', sources:['Social','News'], time:'2h ago' },
    { severity:'critical', text:'<strong>NPS dropped 3 points to 31</strong> — lowest since March 2025. Correlation with driver satisfaction at 0.87.', sources:['Research','Social','Reviews'], time:'6h ago' },
    { severity:'warning', text:'<strong>Gojek launched 40% GoCar discounts in Surabaya and Bandung</strong> — Share of Voice dropped from 51% to 39%.', sources:['Social','Trends'], time:'4h ago' },
    { severity:'warning', text:'<strong>OJK published draft commission structure framework</strong> — public comment period opens March 1.', sources:['News'], time:'8h ago' },
    { severity:'watch', text:'<strong>ShopeeFood expanding dark kitchen network</strong> — 15 new locations detected in Jabodetabek.', sources:['News','Social'], time:'12h ago' },
  ],
  miniWatchlist: [
    { name:'Commission Cap Regulation', severity:'high', stat:'340%', statLabel:'mention spike', delta:'↑ 280%', deltaDir:'up-bad' },
    { name:'Driver Attrition Signal', severity:'high', stat:'44%', statLabel:'pulse score', delta:'↓ 6 pts', deltaDir:'down-bad' },
    { name:'Gojek Pricing', severity:'med', stat:'3 cities', statLabel:'active promos', delta:'+1 city', deltaDir:'up-bad' },
    { name:'Gen Z Sentiment', severity:'low', stat:'+18%', statLabel:'TikTok positive', delta:'↑ 4 pts', deltaDir:'up-good' },
  ],
  engine: [
    { type:'aurora', text:'Gen pop survey Wave 3 ingested — 2,400 responses', time:'2h ago' },
    { type:'amber', text:'Social spike: Grab commission — 847 mentions/24h', time:'6h ago' },
    { type:'blue', text:'AppFollow review sync — 128 new reviews (4.3★ avg)', time:'8h ago' },
    { type:'violet', text:'SerpAPI trend scan complete — 3 new trending topics', time:'12h ago' },
    { type:'aurora', text:'Event Registry news scan — 47 articles indexed', time:'14h ago' },
    { type:'amber', text:'Watchlist trigger: Commission spike > 200% threshold', time:'1d ago' },
  ],
  socialStats: [
    { label:'Share of Voice', val:'47%', sub:'↓ 2.1 vs last month' },
    { label:'Net Sentiment', val:'+61%', sub:'↓ 4 pts vs last week' },
    { label:'Mentions / 24h', val:'4,230', sub:'↑ 12% vs avg' },
    { label:'Platforms', val:'8', sub:'Twitter, TikTok, IG, YT, Kaskus, FB, Reddit, Forums' },
  ],
  socialFeed: [
    { platform:'twitter', user:'@raniwijaya', time:'14m', text:'GrabFood delivery sudah 2 jam belum sampai. Customer service ga bisa dihubungi. Kapok pake Grab 😤', sentiment:'neg', score:'0.89', likes:'342', replies:'48', shares:'127' },
    { platform:'tiktok', user:'@jakartafoodie', time:'1h', text:'Nemu promo GrabFood diskon 60% buat makanan Korea! Worth it banget sih, ayam gorengnya enak parah 🤤', sentiment:'pos', score:'0.94', likes:'12.4K', replies:'891', shares:'2.3K' },
    { platform:'kaskus', user:'agan_driver_jaksel', time:'2h', text:'Udah sebulan nih komisi dipotong makin gede. Kalau begini terus mending pindah ke Maxim aja. Ada yang udah coba?', sentiment:'neg', score:'0.91', likes:'89', replies:'156', shares:'12' },
    { platform:'instagram', user:'@grabid_official', time:'3h', text:'GrabCar baru launch fitur "Jemput di Titik" yang lebih akurat. Ga perlu lama nunggu lagi 🚗✨', sentiment:'pos', score:'0.76', likes:'5.2K', replies:'234', shares:'412' },
    { platform:'twitter', user:'@belomdihire', time:'4h', text:'Beda tipis sih harga Grab sama Gojek sekarang. Lebih ke siapa yang promonya lebih gede aja.', sentiment:'neu', score:'0.52', likes:'78', replies:'23', shares:'11' },
    { platform:'tiktok', user:'@surabaya.eats', time:'5h', text:'Lagi rame Gojek diskon 40% di Surabaya! Grab kapan nyusul? Jangan kalah dong 🙏', sentiment:'neg', score:'0.65', likes:'8.7K', replies:'567', shares:'1.1K' },
    { platform:'kaskus', user:'grab_rider_bdg', time:'6h', text:'Fitur safety baru Grab lumayan bagus. Ada tombol emergency dan share trip real-time ke keluarga.', sentiment:'pos', score:'0.82', likes:'45', replies:'18', shares:'7' },
    { platform:'instagram', user:'@foodie.jkt', time:'7h', text:'Review jujur: GrabFood makin lambat deliverynya tapi pilihan restorannya emang paling lengkap sih 🤷‍♀️', sentiment:'neu', score:'0.48', likes:'1.8K', replies:'156', shares:'89' },
  ],
  newsArticles: [
    { type:'regulatory', title:'OJK proposes new commission structure framework for ride-hailing platforms', summary:'Draft regulation would cap platform commissions at 20%, down from current average of 25-30%. Public comment period opens March 1.', source:'Bisnis Indonesia', time:'3 hours ago', impact:'high' },
    { type:'competitive', title:'Gojek partners with Tokopedia for integrated logistics across 5 new cities', summary:'Partnership leverages Tokopedia merchant network for same-day delivery. Expansion targets Surabaya, Bandung, Medan, Semarang, Makassar.', source:'Kompas', time:'6 hours ago', impact:'high' },
    { type:'regulatory', title:'Ministry of Transport updates minimum fare calculation for online transportation', summary:'New formula considers fuel costs, inflation index, and regional cost of living. Implementation expected Q2 2026.', source:'Tempo', time:'8 hours ago', impact:'medium' },
    { type:'competitive', title:'ShopeeFood expands dark kitchen network with 15 new locations in Jabodetabek', summary:'Aggressive expansion targets underserved areas. Partners with 200+ local restaurants for exclusive cloud kitchen deals.', source:'CNN Indonesia', time:'12 hours ago', impact:'medium' },
    { type:'industry', title:'Indonesian ride-hailing market projected to reach $8.2B by 2027', summary:'Report cites growing middle class and urbanization as key drivers. Food delivery segment growing fastest at 28% CAGR.', source:'Jakarta Post', time:'1 day ago', impact:'low' },
    { type:'industry', title:'Gen Z spending on food delivery up 34% YoY across Southeast Asia', summary:'Research from Bain & Company shows Gen Z prioritizes convenience over price. Brand loyalty remains low in segment.', source:'Nikkei Asia', time:'1 day ago', impact:'medium' },
  ],
  trackersDetail: [
    { label:'Consumer NPS', value:'31', delta:'↓ 3 pts', dir:'down', color:'var(--thermal)',
      sparkData:[38,36,35,37,34,33,36,35,33,34,34,31],
      formula:[
        { name:'Brand24 Social Sentiment', pct:'30%', color:'var(--violet)' },
        { name:'AppFollow Review Score', pct:'25%', color:'var(--blue)' },
        { name:'Quant Research Panel', pct:'35%', color:'var(--aurora)' },
        { name:'SerpAPI Brand Trends', pct:'10%', color:'var(--amber)' },
      ]},
    { label:'Brand Equity Index', value:'54', delta:'↓ 2.1', dir:'down', color:'var(--thermal)',
      sparkData:[60,59,58,57,58,57,56,57,56,55,55,54],
      formula:[
        { name:'Quant Brand Tracking', pct:'40%', color:'var(--aurora)' },
        { name:'Social Share of Voice', pct:'25%', color:'var(--violet)' },
        { name:'App Store Rating', pct:'20%', color:'var(--blue)' },
        { name:'News Sentiment', pct:'15%', color:'var(--amber)' },
      ]},
    { label:'Driver Pulse', value:'44%', delta:'↓ 6 pts', dir:'down', color:'var(--thermal)',
      sparkData:[62,60,58,55,53,52,50,48,50,48,47,44],
      formula:[
        { name:'Driver Panel Survey', pct:'50%', color:'var(--aurora)' },
        { name:'Kaskus Forum Analysis', pct:'20%', color:'var(--amber)' },
        { name:'App Rating (Driver)', pct:'15%', color:'var(--blue)' },
        { name:'Social Driver Mentions', pct:'15%', color:'var(--violet)' },
      ]},
    { label:'Share of Voice', value:'47%', delta:'↓ 2.1', dir:'down', color:'var(--amber)',
      sparkData:[52,51,50,51,50,49,50,49,48,49,48,47],
      formula:[
        { name:'Brand24 Mention Volume', pct:'45%', color:'var(--violet)' },
        { name:'SerpAPI Search Share', pct:'25%', color:'var(--amber)' },
        { name:'News Mention Frequency', pct:'20%', color:'var(--blue)' },
        { name:'App Download Ranking', pct:'10%', color:'var(--aurora)' },
      ]},
    { label:'Service Experience', value:'68', delta:'↑ 1.4', dir:'up', color:'var(--aurora)',
      sparkData:[61,62,63,62,64,65,64,66,65,67,67,68],
      formula:[
        { name:'AppFollow Review Topics', pct:'35%', color:'var(--blue)' },
        { name:'Social Service Mentions', pct:'25%', color:'var(--violet)' },
        { name:'Quant CSAT Score', pct:'30%', color:'var(--aurora)' },
        { name:'App Crash Rate (inverse)', pct:'10%', color:'var(--amber)' },
      ]},
  ],
  researchStudies: [
    { title:'Jan 2026 Brand Health Wave', status:'complete', stats:'n=1,200 · 94% completion', tags:['Quant','CAWI','National'] },
    { title:'Driver Experience Deep Dive', status:'complete', stats:'n=30 IDIs · Transcribed', tags:['Qual','IDI','Jakarta'] },
    { title:'Gen Z Food Delivery Attitudes', status:'active', stats:'n=600 · 67% complete', tags:['Quant','CAWI','18-24'] },
    { title:'Surabaya Market Assessment', status:'planned', stats:'n=400 · Launching Mar 1', tags:['Quant','CAWI','Surabaya'] },
    { title:'Post-Promo Churn Analysis', status:'complete', stats:'n=800 · Dec 2025', tags:['Quant','Panel','Longitudinal'] },
    { title:'Driver Commission Sentiment', status:'active', stats:'n=20 IDIs · 14 done', tags:['Qual','IDI','Drivers'] },
  ],
  watchlistItems: [
    { severity:'critical', title:'Commission Cap Regulation', triggers:'3 triggers / 7d',
      desc:'Monitoring OJK, BI, KPPU for regulatory filings mentioning ride-hailing commission structures. Auto-scanning Bisnis Indonesia, Kontan, and government gazette.',
      stats:[
        { label:'Social Mentions', val:'1,247', delta:'↑ 340%', dir:'up-bad' },
        { label:'News Articles', val:'8', delta:'↑ 5 new', dir:'up-bad' },
        { label:'Regulatory Filings', val:'2', delta:'+1 draft', dir:'up-bad' },
      ]},
    { severity:'critical', title:'Driver Attrition Signal', triggers:'1 trigger / 7d',
      desc:'Alert when Driver Pulse drops below 40% or Kaskus/forum mentions of "pindah platform" spike above 200% baseline.',
      stats:[
        { label:'Driver Pulse', val:'44%', delta:'↓ 6 pts', dir:'down-bad' },
        { label:'"Pindah" Mentions', val:'189', delta:'↑ 156%', dir:'up-bad' },
        { label:'Maxim Mentions', val:'67', delta:'↑ 89%', dir:'up-bad' },
      ]},
    { severity:'warning', title:'Gojek Pricing Offensive', triggers:'5 triggers / 7d',
      desc:'Tracking promo pricing changes in top 8 cities via app monitoring, social signals, and SerpAPI ad tracking.',
      stats:[
        { label:'Active Promos', val:'3 cities', delta:'+1 city', dir:'up-bad' },
        { label:'Avg Discount', val:'40%', delta:'↑ 10%', dir:'up-bad' },
        { label:'SoV Impact', val:'-4.2%', delta:'in promo cities', dir:'down-bad' },
      ]},
    { severity:'warning', title:'ShopeeFood Expansion', triggers:'2 triggers / 7d',
      desc:'Monitoring dark kitchen openings, merchant recruitment ads, and app feature launches across Jabodetabek.',
      stats:[
        { label:'New Locations', val:'15', delta:'this month', dir:'flat' },
        { label:'Merchant Ads', val:'234', delta:'↑ 45%', dir:'up-bad' },
      ]},
    { severity:'watch', title:'Gen Z Sentiment Shift', triggers:'0 triggers / 7d',
      desc:'Tracking 18-24 demographic sentiment across TikTok and Instagram. Monitoring brand switching signals and promo sensitivity.',
      stats:[
        { label:'TikTok Sentiment', val:'+18%', delta:'↑ 4 pts', dir:'up-good' },
        { label:'Brand Loyalty', val:'34%', delta:'↓ 2 pts', dir:'down-bad' },
      ]},
    { severity:'watch', title:'Maxim Market Entry', triggers:'1 trigger / 7d',
      desc:'New competitor monitoring across all data sources in tier-2 and tier-3 cities. Tracking driver recruitment and promotional activity.',
      stats:[
        { label:'Cities Active', val:'6', delta:'+2 new', dir:'up-bad' },
        { label:'Driver Recruitment', val:'Active', delta:'3 cities', dir:'flat' },
      ]},
  ],
};

/* ═══════════════════════════════════════════
   SPARKLINE UTILITY
   ═══════════════════════════════════════════ */
function drawSparkline(canvas, data, color, fillAlpha=0.08, w, h, animate=false, animDuration=1200) {
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;
  const cw = w || canvas.parentElement?.offsetWidth || canvas.width;
  const ch = h || canvas.parentElement?.offsetHeight || canvas.height;
  canvas.width = cw * dpr;
  canvas.height = ch * dpr;
  canvas.style.width = cw + 'px';
  canvas.style.height = ch + 'px';
  ctx.scale(dpr, dpr);

  const min = Math.min(...data) - 2;
  const max = Math.max(...data) + 2;
  const step = cw / (data.length - 1);
  const getY = v => ch - ((v - min) / (max - min)) * ch;
  const resolvedColor = getComputedStyle(document.documentElement).getPropertyValue(color.replace('var(','').replace(')','').trim()) || color;
  const rc = resolvedColor.trim();

  function drawFrame(progress) {
    ctx.clearRect(0, 0, cw, ch);
    const drawLen = progress * cw;

    ctx.save();
    ctx.beginPath();
    ctx.rect(0, 0, drawLen, ch);
    ctx.clip();

    // fill
    ctx.beginPath();
    ctx.moveTo(0, getY(data[0]));
    data.forEach((v, i) => ctx.lineTo(i * step, getY(v)));
    ctx.lineTo(cw, ch);
    ctx.lineTo(0, ch);
    ctx.closePath();
    ctx.fillStyle = rc + (Math.round(fillAlpha * 255)).toString(16).padStart(2,'0');
    ctx.fill();

    // line
    ctx.beginPath();
    ctx.moveTo(0, getY(data[0]));
    data.forEach((v, i) => ctx.lineTo(i * step, getY(v)));
    ctx.strokeStyle = rc;
    ctx.lineWidth = 1.5;
    ctx.lineJoin = 'round';
    ctx.lineCap = 'round';
    ctx.stroke();

    ctx.restore();

    // end dot when complete
    if (progress >= 1) {
      const last = data.length - 1;
      ctx.beginPath();
      ctx.arc(last * step, getY(data[last]), 3, 0, Math.PI * 2);
      ctx.fillStyle = rc;
      ctx.fill();
    }
  }

  if (!animate) {
    drawFrame(1);
    return;
  }

  let start = null;
  function anim(ts) {
    if (!start) start = ts;
    const progress = Math.min((ts - start) / animDuration, 1);
    const ease = 1 - Math.pow(1 - progress, 3);
    drawFrame(ease);
    if (progress < 1) requestAnimationFrame(anim);
  }
  requestAnimationFrame(anim);
}

function resolveColor(c) {
  if (c.startsWith('var(')) {
    const prop = c.slice(4, -1);
    return getComputedStyle(document.documentElement).getPropertyValue(prop).trim();
  }
  return c;
}

/* ═══════════════════════════════════════════
   COUNT-UP ANIMATION
   ═══════════════════════════════════════════ */
function countUp(el, target, duration=1000, prefix='', suffix='') {
  const isFloat = String(target).includes('.');
  const hasComma = String(target).includes(',');
  const numericStr = String(target).replace(/[^0-9.\-]/g, '');
  const end = parseFloat(numericStr);
  if (isNaN(end)) { el.textContent = prefix + target + suffix; return; }
  let start = null;
  function step(ts) {
    if (!start) start = ts;
    const progress = Math.min((ts - start) / duration, 1);
    const ease = 1 - Math.pow(1 - progress, 3); // easeOutCubic
    const current = ease * end;
    let display;
    if (isFloat) display = current.toFixed(1);
    else if (hasComma) display = Math.round(current).toLocaleString();
    else display = Math.round(current).toString();
    el.textContent = prefix + display + suffix;
    if (progress < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

function animateMonitorNumbers() {
  // Hero NPS value
  const heroVal = document.querySelector('.hero-value');
  if (heroVal) countUp(heroVal, 31, 1000);
  // Tracker card values
  document.querySelectorAll('.tracker-card').forEach(card => {
    const valEl = card.querySelector('.tracker-value');
    if (!valEl) return;
    const raw = valEl.textContent.trim();
    const suffix = raw.includes('%') ? '%' : '';
    const num = raw.replace('%','');
    countUp(valEl, num, 1000, '', suffix);
  });
}

function animateSocialNumbers() {
  document.querySelectorAll('#socialStats .stat-val').forEach(el => {
    const raw = el.textContent.trim();
    const prefix = raw.startsWith('+') ? '+' : '';
    const suffix = raw.includes('%') ? '%' : '';
    const num = raw.replace(/[+%]/g, '');
    countUp(el, num, 1000, prefix, suffix);
  });
}

/* ═══════════════════════════════════════════
   RENDER FUNCTIONS
   ═══════════════════════════════════════════ */

// Hero sparkline with animated draw-in
function renderHeroSparkline() {
  const canvas = document.getElementById('heroSparkline');
  const data = [38,36,35,37,34,33,36,35,33,34,34,31];
  const color = '#FF2D78';
  const cw = 280, ch = 80;
  const dpr = window.devicePixelRatio || 1;
  canvas.width = cw * dpr;
  canvas.height = ch * dpr;
  canvas.style.width = cw + 'px';
  canvas.style.height = ch + 'px';
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);

  const min = Math.min(...data) - 2;
  const max = Math.max(...data) + 2;
  const step = cw / (data.length - 1);
  const getY = v => ch - ((v - min) / (max - min)) * (ch - 8) - 4;

  const duration = 1200;
  let start = null;
  function animate(ts) {
    if (!start) start = ts;
    const elapsed = ts - start;
    const progress = Math.min(elapsed / duration, 1);
    const ease = 1 - Math.pow(1 - progress, 3);
    const drawLen = ease * cw;

    ctx.clearRect(0, 0, cw, ch);

    ctx.save();
    ctx.beginPath();
    ctx.rect(0, 0, drawLen, ch);
    ctx.clip();

    // gradient fill beneath the line
    ctx.beginPath();
    ctx.moveTo(0, getY(data[0]));
    data.forEach((v, i) => ctx.lineTo(i * step, getY(v)));
    ctx.lineTo(cw, ch);
    ctx.lineTo(0, ch);
    ctx.closePath();
    const grad = ctx.createLinearGradient(0, 0, 0, ch);
    grad.addColorStop(0, 'rgba(255,45,120,0.28)');
    grad.addColorStop(0.6, 'rgba(255,45,120,0.08)');
    grad.addColorStop(1, 'rgba(255,45,120,0.0)');
    ctx.fillStyle = grad;
    ctx.fill();

    // line
    ctx.beginPath();
    ctx.moveTo(0, getY(data[0]));
    data.forEach((v, i) => ctx.lineTo(i * step, getY(v)));
    ctx.strokeStyle = color;
    ctx.lineWidth = 2.5;
    ctx.lineJoin = 'round';
    ctx.lineCap = 'round';
    ctx.stroke();

    ctx.restore();

    // end dot + glow when fully drawn
    if (progress >= 1) {
      const last = data.length - 1;
      ctx.beginPath();
      ctx.arc(last * step, getY(data[last]), 10, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(255,45,120,0.15)';
      ctx.fill();
      ctx.beginPath();
      ctx.arc(last * step, getY(data[last]), 4.5, 0, Math.PI * 2);
      ctx.fillStyle = color;
      ctx.fill();
    }

    if (progress < 1) requestAnimationFrame(animate);
  }
  requestAnimationFrame(animate);
}

// Tracker grid (Monitor)
const MONTHS = ['Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec','Jan','Feb'];
function renderTrackerGrid() {
  const el = document.getElementById('trackerGrid');
  el.innerHTML = DATA.trackers.map((t, i) => {
    const d = t.sparkData;
    const last3 = d.slice(-3).map((v,j) => `<span class="trk-tip-pt">${MONTHS[d.length-3+j]}: <strong style="color:var(--text-1)">${v}${t.value.includes('%')?'%':''}</strong></span>`).join('');
    return `
    <div class="tracker-card" style="position:relative" onclick="switchView('conversations')">
      <div class="trk-tip">
        <div class="trk-tip-title">Last 3 months</div>
        <div class="trk-tip-row">${last3}</div>
        <div class="trk-tip-src">Source: ${t.source}</div>
      </div>
      <div class="tracker-header">
        <div class="tracker-label">${t.label}</div>
        <div class="tracker-source-tag">${t.source}</div>
      </div>
      <div class="tracker-value">${t.value}</div>
      <div class="tracker-delta ${t.dir}">${t.delta}</div>
      <div class="tracker-sparkline"><canvas id="trkSpark${i}"></canvas></div>
      <div class="tracker-segments" data-card-idx="${i}">${t.segments.map(s => `<div class="tracker-seg-bar" data-flex="${s.w}" style="background:${s.c};flex:0"></div>`).join('')}</div>
      <div class="tracker-comp"><span>${t.comp}</span><span class="tracker-comp-val">vs competitor</span></div>
    </div>`;
  }).join('');
  // draw sparklines with stagger (150ms between each, starts after hero finishes)
  DATA.trackers.forEach((t, i) => {
    setTimeout(() => {
      const c = document.getElementById('trkSpark' + i);
      if (c) drawSparkline(c, t.sparkData, resolveColor(t.color), 0.08, null, null, true, 1200);
    }, 50 + i * 150);
  });
}

// Intelligence Pulse
function renderPulse() {
  document.getElementById('pulseList').innerHTML = DATA.pulse.map(p => `
    <div class="pulse-item" onclick="switchView('conversations')">
      <div class="pulse-severity ${p.severity}">${p.severity}</div>
      <div class="pulse-body">
        <div class="pulse-text">${p.text}</div>
        <div class="pulse-meta">
          ${p.sources.map(s => `<span class="pulse-source-tag ${s.toLowerCase().replace(/\s+/g,'')}">${s}</span>`).join('')}
          <span class="pulse-time">${p.time}</span>
        </div>
      </div>
      <div class="pulse-arrow">→</div>
    </div>
  `).join('');
}

// Mini watchlist
function renderMiniWatchlist() {
  document.getElementById('miniWatchlist').innerHTML = DATA.miniWatchlist.map(w => `
    <div class="mini-watchlist-item" onclick="switchView('watchlist')">
      <div class="mini-w-dot ${w.severity}"></div>
      <div class="mini-w-name">${w.name}</div>
      <div class="mini-w-stat">${w.stat}</div>
      <div class="mini-w-delta" style="color:${w.deltaDir.includes('good')?'var(--aurora)':'var(--thermal)'}">${w.delta}</div>
    </div>
  `).join('');
}

// Engine log
function renderEngine() {
  const colors = { aurora:'var(--aurora)', blue:'var(--blue)', amber:'var(--amber)', violet:'var(--violet-g)' };
  document.getElementById('engineLog').innerHTML = DATA.engine.map(e => `
    <div class="engine-item">
      <div class="engine-dot" style="background:${colors[e.type]}"></div>
      <span>${e.text}</span>
      <span class="engine-time">${e.time}</span>
    </div>
  `).join('');
}

// Social stats
function renderSocialStats() {
  document.getElementById('socialStats').innerHTML = DATA.socialStats.map(s => `
    <div class="stat-card">
      <div class="stat-label">${s.label}</div>
      <div class="stat-val">${s.val}</div>
      <div class="stat-sub">${s.sub}</div>
    </div>
  `).join('');
}

// Social feed
function renderSocialFeed() {
  document.getElementById('socialFeed').innerHTML = DATA.socialFeed.map(f => `
    <div class="feed-item">
      <div class="feed-head">
        <span class="feed-platform ${f.platform}">${f.platform}</span>
        <span class="feed-user">${f.user} · ${f.time}</span>
      </div>
      <div class="feed-text">${f.text}</div>
      <div class="feed-bottom">
        <span class="feed-sentiment ${f.sentiment}">${f.sentiment === 'pos' ? 'Positive' : f.sentiment === 'neg' ? 'Negative' : 'Neutral'} · ${f.score}</span>
        <span class="feed-engagement">❤ ${f.likes} · 💬 ${f.replies} · ↗ ${f.shares}</span>
      </div>
    </div>
  `).join('');
}

// News stats
function renderNewsStats() {
  const stats = [
    { label:'Articles / 24h', val:'47', sub:'across 34 outlets' },
    { label:'Regulatory Filings', val:'3', sub:'OJK, BI, KPPU' },
    { label:'High Impact', val:'5', sub:'requires attention' },
    { label:'Competitor Mentions', val:'18', sub:'Gojek 11, ShopeeFood 7' },
  ];
  document.getElementById('newsStats').innerHTML = stats.map(s => `
    <div class="stat-card">
      <div class="stat-label">${s.label}</div>
      <div class="stat-val">${s.val}</div>
      <div class="stat-sub">${s.sub}</div>
    </div>
  `).join('');
}

// News articles
function renderNewsList() {
  document.getElementById('newsList').innerHTML = DATA.newsArticles.map(a => `
    <div class="news-card">
      <div class="news-type-badge ${a.type}">${a.type}</div>
      <div class="news-body">
        <div class="news-title">${a.title}</div>
        <div class="news-summary">${a.summary}</div>
        <div class="news-meta">
          <span>${a.source}</span>
          <span>${a.time}</span>
          <span class="news-impact ${a.impact}">${a.impact} impact</span>
        </div>
      </div>
    </div>
  `).join('');
}

// Trackers detail
function renderTrackersDetail() {
  const el = document.getElementById('trackersDetailGrid');
  el.innerHTML = DATA.trackersDetail.map((t, i) => `
    <div class="tracker-detail-card">
      <div class="td-header">
        <div>
          <div class="td-label">${t.label}</div>
          <div class="td-value" style="color:${t.color}">${t.value}</div>
          <div class="td-delta" style="color:${t.color}">${t.delta} vs last month</div>
        </div>
      </div>
      <div class="td-sparkline"><canvas id="tdSpark${i}"></canvas></div>
      <div class="td-formula">
        <div class="td-formula-title">Data Source Formula</div>
        ${t.formula.map(f => `
          <div class="td-formula-item">
            <div class="td-formula-dot" style="background:${f.color}"></div>
            <span>${f.name}</span>
            <span class="td-formula-pct">${f.pct}</span>
          </div>
        `).join('')}
      </div>
    </div>
  `).join('');
}
function drawTrackerDetailSparklines() {
  DATA.trackersDetail.forEach((t, i) => {
    const c = document.getElementById('tdSpark' + i);
    if (c) drawSparkline(c, t.sparkData, resolveColor(t.color), 0.1);
  });
}

// Research
function renderResearch() {
  document.getElementById('researchGrid').innerHTML = DATA.researchStudies.map(r => `
    <div class="research-card">
      <div class="research-status ${r.status}">${r.status}</div>
      <div class="research-card-title">${r.title}</div>
      <div class="research-stats">${r.stats}</div>
      <div class="research-tags">${r.tags.map(t => `<span class="research-tag">${t}</span>`).join('')}</div>
    </div>
  `).join('');
}

// Watchlist
function renderWatchlist() {
  document.getElementById('watchlistGrid').innerHTML = DATA.watchlistItems.map(w => `
    <div class="watchlist-card">
      <div class="wl-header">
        <div class="wl-severity ${w.severity}">${w.severity}</div>
        <div class="wl-title">${w.title}</div>
        <div class="wl-triggers">${w.triggers}</div>
      </div>
      <div class="wl-desc">${w.desc}</div>
      <div class="wl-stats">
        ${w.stats.map(s => `
          <div class="wl-stat">
            <div class="wl-stat-label">${s.label}</div>
            <div class="wl-stat-val">${s.val}</div>
            <div class="wl-stat-delta" style="color:${s.dir.includes('good')?'var(--aurora)':'var(--thermal)'}">${s.delta}</div>
          </div>
        `).join('')}
      </div>
    </div>
  `).join('');
}

/* ═══════════════════════════════════════════
   SEGMENT BAR ANIMATION
   ═══════════════════════════════════════════ */
function animateSegmentBars() {
  document.querySelectorAll('.tracker-segments[data-card-idx]').forEach(seg => {
    const idx = parseInt(seg.dataset.cardIdx);
    const bars = seg.querySelectorAll('.tracker-seg-bar');
    bars.forEach(bar => { bar.style.flex = '0'; });
    setTimeout(() => {
      bars.forEach(bar => { bar.style.flex = bar.dataset.flex; });
    }, 200 + idx * 100); // stagger 100ms per card
  });
}

/* ═══════════════════════════════════════════
   AI THINKING DOTS (for new user messages)
   ═══════════════════════════════════════════ */
function runDemoTyping() { /* no-op: pre-populated message shows instantly */ }

/* ═══════════════════════════════════════════
   NAVIGATION (crossfade)
   ═══════════════════════════════════════════ */
let currentView = 'monitor';
function switchView(name) {
  if (name === currentView) return;
  const oldView = document.getElementById('view-' + currentView);
  const newView = document.getElementById('view-' + name);

  // update rail
  document.querySelectorAll('.rail-item').forEach(r => r.classList.remove('active'));
  const rail = document.querySelector(`.rail-item[data-view="${name}"]`);
  if (rail) rail.classList.add('active');

  // fade out old
  if (oldView) {
    oldView.classList.remove('visible');
    setTimeout(() => { oldView.classList.remove('active'); }, 160);
  }

  // fade in new
  if (newView) {
    newView.classList.add('active');
    // force reflow before adding visible class
    void newView.offsetHeight;
    requestAnimationFrame(() => { newView.classList.add('visible'); });
  }

  // hide convo bar on conversations view
  document.getElementById('convoBar').style.display = name === 'conversations' ? 'none' : 'block';

  // lazy draw sparklines for trackers detail view
  if (name === 'trackers') {
    setTimeout(drawTrackerDetailSparklines, 60);
  }

  // trigger monitor animations
  if (name === 'monitor') {
    setTimeout(animateSegmentBars, 100);
    setTimeout(animateMonitorNumbers, 100);
    // re-draw tracker sparklines with animation
    DATA.trackers.forEach((t, i) => {
      setTimeout(() => {
        const c = document.getElementById('trkSpark' + i);
        if (c) drawSparkline(c, t.sparkData, resolveColor(t.color), 0.08, null, null, true, 1200);
      }, 50 + i * 150);
    });
    renderHeroSparkline();
  }

  // trigger social number count-up
  if (name === 'social') {
    setTimeout(animateSocialNumbers, 200);
  }

  // trigger typing animation when switching to conversations
  if (name === 'conversations') {
    setTimeout(runDemoTyping, 400);
  }

  currentView = name;
}

document.querySelectorAll('.rail-item').forEach(item => {
  item.addEventListener('click', () => switchView(item.dataset.view));
});

/* ═══════════════════════════════════════════
   CHAT (Conversations view)
   ═══════════════════════════════════════════ */
document.getElementById('convSendBtn').addEventListener('click', () => {
  const input = document.getElementById('convInput');
  if (!input.value.trim()) return;
  const area = document.getElementById('convMessages');
  const userMsg = document.createElement('div');
  userMsg.className = 'msg user';
  userMsg.innerHTML = `<div class="msg-avatar">Y</div><div class="msg-bubble">${input.value}</div>`;
  area.appendChild(userMsg);
  area.scrollTop = area.scrollHeight;
  const q = input.value;
  input.value = '';

  // Show thinking dots
  const thinkMsg = document.createElement('div');
  thinkMsg.className = 'msg ai';
  thinkMsg.innerHTML = `<div class="msg-avatar">C</div><div class="msg-bubble"><div class="thinking-dots"><span></span><span></span><span></span></div></div>`;
  area.appendChild(thinkMsg);
  area.scrollTop = area.scrollHeight;

  // After 1.5s, replace with actual response (fade in)
  setTimeout(() => {
    const bubble = thinkMsg.querySelector('.msg-bubble');
    bubble.style.opacity = '0';
    bubble.style.transition = 'opacity 300ms ease';
    bubble.innerHTML = `Analyzing across all 7 data sources for your query: "<strong>${q}</strong>"...<br><br>In the live product, I would synthesize real-time data from Brand24, AppFollow, Event Registry, SerpAPI, your research module, app intelligence, and regulatory filings to provide a grounded, multi-source answer with confidence scoring.<br><br><span class="msg-cite">ClarityOS prototype · demo mode</span>`;
    requestAnimationFrame(() => { bubble.style.opacity = '1'; });
    area.scrollTop = area.scrollHeight;
  }, 1500);
});
document.getElementById('convInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') document.getElementById('convSendBtn').click();
});

/* Global input → go to conversations */
document.getElementById('globalSend').addEventListener('click', () => {
  const val = document.getElementById('globalInput').value.trim();
  if (!val) return;
  document.getElementById('convInput').value = val;
  document.getElementById('globalInput').value = '';
  switchView('conversations');
  setTimeout(() => document.getElementById('convSendBtn').click(), 100);
});
document.getElementById('globalInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') document.getElementById('globalSend').click();
});

/* ═══════════════════════════════════════════
   ROTATING SUGGESTION CHIPS
   ═══════════════════════════════════════════ */
const CHIP_POOL = [
  'How is brand equity trending this month?',
  'Summarize the top driver complaints',
  'Compare our NPS with Gojek',
  'What are the latest regulatory risks?',
  'Show me the commission cap discussion',
  'How is Gen Z sentiment changing?',
  'What\'s ShopeeFood doing in Jabodetabek?',
  'Analyze the latest app store reviews',
  'Which cities have active Gojek promos?',
  'What are the top trending topics today?',
  'Give me a competitive landscape overview',
  'Summarize this week\'s social listening'
];
let chipSetIndex = 0;
function renderChipSets() {
  const container = document.getElementById('chipContainer');
  container.innerHTML = '';
  const sets = [];
  for (let s = 0; s < 3; s++) {
    const setDiv = document.createElement('div');
    setDiv.className = 'chip-set' + (s === 0 ? ' visible' : ' hidden');
    for (let i = 0; i < 4; i++) {
      const chip = document.createElement('div');
      chip.className = 'convo-chip';
      chip.textContent = CHIP_POOL[s * 4 + i];
      setDiv.appendChild(chip);
    }
    container.appendChild(setDiv);
    sets.push(setDiv);
  }
  chipSetIndex = 0;
  setInterval(() => {
    const allSets = container.querySelectorAll('.chip-set');
    allSets[chipSetIndex].classList.remove('visible');
    allSets[chipSetIndex].classList.add('hidden');
    chipSetIndex = (chipSetIndex + 1) % allSets.length;
    allSets[chipSetIndex].classList.remove('hidden');
    allSets[chipSetIndex].classList.add('visible');
  }, 8000);
}
/* Delegated chip clicks */
document.getElementById('chipContainer').addEventListener('click', e => {
  const chip = e.target.closest('.convo-chip');
  if (!chip) return;
  document.getElementById('globalInput').value = chip.textContent;
  document.getElementById('globalSend').click();
});

/* ═══════════════════════════════════════════
   COMMAND PALETTE (⌘K)
   ═══════════════════════════════════════════ */
const cmdOverlay = document.getElementById('cmdOverlay');
const cmdInput = document.getElementById('cmdInput');
const cmdResults = document.getElementById('cmdResults');

function buildSearchIndex() {
  const items = [];
  /* Navigation views */
  const views = [
    { label:'Monitor — Dashboard Overview', view:'monitor', icon:'📊' },
    { label:'Conversations — AI Chat', view:'conversations', icon:'💬' },
    { label:'Social Listening — Mentions & Sentiment', view:'social', icon:'📡' },
    { label:'News & Regulatory', view:'news', icon:'📰' },
    { label:'Trackers — Composite Metrics Detail', view:'trackers', icon:'📈' },
    { label:'Research — Studies & Surveys', view:'research', icon:'🔬' },
    { label:'Watchlist — Alerts & Triggers', view:'watchlist', icon:'🔔' },
  ];
  views.forEach(v => items.push({ type:'View', label:v.label, icon:v.icon, action:() => { closePalette(); switchView(v.view); } }));
  /* Trackers (from detail view — includes all 5 composite metrics) */
  DATA.trackersDetail.forEach(t => items.push({ type:'Tracker', label:t.label + ' — ' + t.value + (t.value.includes('%')?'':' pts'), icon:'📈', action:() => { closePalette(); switchView('trackers'); } }));
  /* Watchlist items */
  DATA.watchlistItems.forEach(w => items.push({ type:'Watchlist', label:w.title, icon:'🔔', action:() => { closePalette(); switchView('watchlist'); } }));
  /* Pulse items */
  DATA.pulse.forEach(p => {
    const plainText = p.text.replace(/<[^>]*>/g, '');
    items.push({ type:'Alert', label:plainText.substring(0, 80) + '...', icon: p.severity === 'critical' ? '🔴' : p.severity === 'warning' ? '🟡' : '🟢', action:() => { closePalette(); switchView('monitor'); } });
  });
  return items;
}

const searchIndex = buildSearchIndex();
let selectedIdx = 0;

function renderResults(query) {
  const q = query.toLowerCase().trim();
  const filtered = q ? searchIndex.filter(item => item.label.toLowerCase().includes(q)) : searchIndex.slice(0, 8);
  selectedIdx = 0;
  if (filtered.length === 0) {
    cmdResults.innerHTML = '<div style="padding:16px 20px;color:var(--text-4);font-size:13px;text-align:center;">No results found</div>';
    return;
  }
  cmdResults.innerHTML = filtered.slice(0, 10).map((item, i) =>
    `<div class="cmd-result${i === 0 ? ' selected' : ''}" data-idx="${i}">
      <span class="cmd-result-icon">${item.icon}</span>
      <div class="cmd-result-text">
        <div class="cmd-result-label">${item.label}</div>
        <div class="cmd-result-type">${item.type}</div>
      </div>
    </div>`
  ).join('');
  /* Store filtered for execution */
  cmdResults._filtered = filtered.slice(0, 10);
}

function openPalette() {
  cmdOverlay.classList.add('open');
  cmdInput.value = '';
  renderResults('');
  setTimeout(() => cmdInput.focus(), 50);
}

function closePalette() {
  cmdOverlay.classList.remove('open');
  cmdInput.blur();
}

cmdInput.addEventListener('input', () => renderResults(cmdInput.value));

cmdInput.addEventListener('keydown', e => {
  const results = cmdResults.querySelectorAll('.cmd-result');
  if (e.key === 'ArrowDown') {
    e.preventDefault();
    results[selectedIdx]?.classList.remove('selected');
    selectedIdx = Math.min(selectedIdx + 1, results.length - 1);
    results[selectedIdx]?.classList.add('selected');
    results[selectedIdx]?.scrollIntoView({ block:'nearest' });
  } else if (e.key === 'ArrowUp') {
    e.preventDefault();
    results[selectedIdx]?.classList.remove('selected');
    selectedIdx = Math.max(selectedIdx - 1, 0);
    results[selectedIdx]?.classList.add('selected');
    results[selectedIdx]?.scrollIntoView({ block:'nearest' });
  } else if (e.key === 'Enter') {
    e.preventDefault();
    const filtered = cmdResults._filtered;
    if (filtered && filtered[selectedIdx]) filtered[selectedIdx].action();
  } else if (e.key === 'Escape') {
    closePalette();
  }
});

cmdOverlay.addEventListener('click', e => {
  if (e.target === cmdOverlay) closePalette();
});

/* ⌘K shortcut */
document.addEventListener('keydown', e => {
  if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
    e.preventDefault();
    if (cmdOverlay.classList.contains('open')) closePalette();
    else openPalette();
  }
  if (e.key === 'Escape' && cmdOverlay.classList.contains('open')) {
    closePalette();
  }
});

/* ═══════════════════════════════════════════
   CLOCK
   ═══════════════════════════════════════════ */
function updateClock() {
  const tz = 'Asia/Jakarta';
  const now = new Date();
  const dateStr = now.toLocaleDateString('en-US', { month:'short', day:'numeric', year:'numeric', timeZone:tz });
  const timeStr = now.toLocaleTimeString('en-US', { hour:'numeric', minute:'2-digit', timeZone:tz });
  document.getElementById('headerTime').textContent = dateStr + ' · ' + timeStr + ' WIB';
}
setInterval(updateClock, 60000);

/* ═══════════════════════════════════════════
   INIT
   ═══════════════════════════════════════════ */
renderHeroSparkline();
renderTrackerGrid();
renderPulse();
renderMiniWatchlist();
renderEngine();
renderSocialStats();
renderSocialFeed();
renderNewsStats();
renderNewsList();
renderTrackersDetail();
renderResearch();
renderWatchlist();
renderChipSets();
updateClock();

// Kick off initial view transition + animations
requestAnimationFrame(() => {
  document.getElementById('view-monitor').classList.add('visible');
  setTimeout(animateSegmentBars, 300);
  setTimeout(animateMonitorNumbers, 100);
});
</script>
</body>
</html>
